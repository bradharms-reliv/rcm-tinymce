/*! rcm-tinymce 2016-06-21 */

tinymce.PluginManager.add("linkwithjqueryautocomplete",function(editor){function createLinkList(callback){return function(){var linkList=editor.settings.link_list;"string"==typeof linkList?tinymce.util.XHR.send({url:linkList,success:function(text){callback(tinymce.util.JSON.parse(text))}}):"function"==typeof linkList?linkList(callback):callback(linkList)}}function buildListItems(inputList,itemCallback,startItems){function appendItems(values,output){return output=output||[],tinymce.each(values,function(item){var menuItem={text:item.text||item.title};item.menu?menuItem.menu=appendItems(item.menu):(menuItem.value=item.value,itemCallback&&itemCallback(menuItem)),output.push(menuItem)}),output}return appendItems(inputList,startItems||[])}function showDialog(linkList){function linkListChangeHandler(e){var textCtrl=win.find("#text");(!textCtrl.value()||e.lastControl&&textCtrl.value()==e.lastControl.text())&&textCtrl.value(e.control.text()),win.find("#href").value(e.control.value())}function buildAnchorListControl(url){var anchorList=[];if(tinymce.each(editor.dom.select("a:not([href])"),function(anchor){var id=anchor.name||anchor.id;id&&anchorList.push({text:id,value:"#"+id,selected:url.indexOf("#"+id)!=-1})}),anchorList.length)return anchorList.unshift({text:"None",value:""}),{name:"anchor",type:"listbox",label:"Anchors",values:anchorList,onselect:linkListChangeHandler}}function updateText(){!initialText&&0===data.text.length&&onlyText&&this.parent().parent().find("#text")[0].value(this.value())}function urlChange(e){var meta=e.meta||{};linkListCtrl&&linkListCtrl.value(editor.convertURL(this.value(),"href")),tinymce.each(e.meta,function(value,key){win.find("#"+key).value(value)}),meta.text||updateText.call(this)}function isOnlyTextSelected(anchorElm){var html=selection.getContent();if(/</.test(html)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(html)||html.indexOf("href=")==-1))return!1;if(anchorElm){var i,nodes=anchorElm.childNodes;if(0===nodes.length)return!1;for(i=nodes.length-1;i>=0;i--)if(3!=nodes[i].nodeType)return!1}return!0}var selectedElm,anchorElm,initialText,win,onlyText,textListCtrl,linkListCtrl,relListCtrl,targetListCtrl,classListCtrl,linkTitleCtrl,value,data={},selection=editor.selection,dom=editor.dom;selectedElm=selection.getNode(),anchorElm=dom.getParent(selectedElm,"a[href]"),onlyText=isOnlyTextSelected(),data.text=initialText=anchorElm?anchorElm.innerText||anchorElm.textContent:selection.getContent({format:"text"}),data.href=anchorElm?dom.getAttrib(anchorElm,"href"):"",(value=dom.getAttrib(anchorElm,"target"))?data.target=value:editor.settings.default_link_target&&(data.target=editor.settings.default_link_target),(value=dom.getAttrib(anchorElm,"rel"))&&(data.rel=value),(value=dom.getAttrib(anchorElm,"class"))&&(data["class"]=value),(value=dom.getAttrib(anchorElm,"title"))&&(data.title=value),onlyText&&(textListCtrl={name:"text",type:"textbox",size:40,label:"Text to display",onchange:function(){data.text=this.value()}}),editor.settings.target_list!==!1&&(editor.settings.target_list||(editor.settings.target_list=[{text:"None",value:""},{text:"New window",value:"_blank"}]),targetListCtrl={name:"target",type:"listbox",label:"Target",values:buildListItems(editor.settings.target_list)}),editor.settings.rel_list&&(relListCtrl={name:"rel",type:"listbox",label:"Rel",values:buildListItems(editor.settings.rel_list)}),editor.settings.link_class_list&&(classListCtrl={name:"class",type:"listbox",label:"Class",values:buildListItems(editor.settings.link_class_list,function(item){item.value&&(item.textStyle=function(){return editor.formatter.getCssText({inline:"a",classes:[item.value]})})})}),editor.settings.link_title!==!1&&(linkTitleCtrl={name:"title",type:"textbox",label:"Title",value:data.title}),win=editor.windowManager.open({title:"Insert link",data:data,body:[{name:"href",type:"filepicker",filetype:"file",size:40,autofocus:!0,label:"Url",onchange:urlChange,onkeyup:updateText},textListCtrl,linkTitleCtrl,buildAnchorListControl(data.href),relListCtrl,targetListCtrl,classListCtrl],onSubmit:function(e){function delayedConfirm(message,callback){var rng=editor.selection.getRng();window.setTimeout(function(){editor.windowManager.confirm(message,function(state){editor.selection.setRng(rng),callback(state)})},0)}function insertLink(){var linkAttrs={href:href,target:data.target?data.target:null,rel:data.rel?data.rel:null,"class":data["class"]?data["class"]:null,title:data.title?data.title:null};anchorElm?(editor.focus(),onlyText&&data.text!=initialText&&("innerText"in anchorElm?anchorElm.innerText=data.text:anchorElm.textContent=data.text),dom.setAttribs(anchorElm,linkAttrs),selection.select(anchorElm),editor.undoManager.add()):onlyText?editor.insertContent(dom.createHTML("a",linkAttrs,dom.encode(data.text))):editor.execCommand("mceInsertLink",!1,linkAttrs)}var href;return data=tinymce.extend(data,e.data),(href=data.href)?href.indexOf("@")>0&&href.indexOf("//")==-1&&href.indexOf("mailto:")==-1?void delayedConfirm("The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",function(state){state&&(href="mailto:"+href),insertLink()}):/^\s*www\./i.test(href)?void delayedConfirm("The URL you entered seems to be an external link. Do you want to add the required http:// prefix?",function(state){state&&(href="http://"+href),insertLink()}):void insertLink():void editor.execCommand("unlink")}});var autoCompleteLinkList=[];$.each(linkList,function(){autoCompleteLinkList.push(this.value)});var urlInput=$("#"+win.find("#href")[0]._id+"-inp");urlInput.autocomplete({source:autoCompleteLinkList,minLength:0}),urlInput.keydown(function(e){var code=e.keyCode?e.keyCode:e.which;13==code&&e.stopPropagation()})}editor.addButton("link",{icon:"link",tooltip:"Insert/edit link",shortcut:"Ctrl+K",onclick:createLinkList(showDialog),stateSelector:"a[href]"}),editor.addButton("unlink",{icon:"unlink",tooltip:"Remove link",cmd:"unlink",stateSelector:"a[href]"}),editor.addShortcut("Ctrl+K","",createLinkList(showDialog)),editor.addCommand("mceLink",createLinkList(showDialog)),this.showDialog=showDialog,editor.addMenuItem("link",{icon:"link",text:"Insert link",shortcut:"Ctrl+K",onclick:createLinkList(showDialog),stateSelector:"a[href]",context:"insert",prependToContext:!0})});
//# sourceMappingURL=plugin.min.js.map